<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head><title>
  
  Ruby Socket + Redcarpet = Browser-Based Markdown Preview | Miles Sandlar
  
</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link rel="icon" href="/style/images/favicon.ico" />
<link rel="stylesheet" href="/css/all.css"/>
<script type="text/javascript" src="/style/all.js"></script>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-22486639-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>
	<body onload="sh_highlightDocument();">
		<div id="main">
			<header>
    <nav>
      
        <a  href="/front-end">Front End</a>
      
        <a  href="/interfaces">Interface</a>
      

      <span class='seperator'></span>
      
        <a  href="/miscart">&omega;</a>
      
        <a class='active' href="/blog">&beta;</a>
      
        <a  href="/contact">&#9993</a>
      
  </nav>


  <div class="right links">
    <a class="a" title="My Resume" href="/resources/resume.pdf">M</a><a target="_blank" class="b" title="My Github Account" href='http://github.com/mil'>i</a><a target="_blank" class="c" title="You've spotted me!" href='http://www.freep.com/article/20130921/news05/309210021'>l</a><a target="_blank" class="d" title="My LinkedIn Account" href='http://linkedin.com/in/sandlar'>e</a><a target="_blank" class="e" title="My Ancient Web Design Company" href='http://logicdrift.com'>s</a>
  </div>
</header>

			<div id="main-content">
	<div class="post last">
		<h2>Ruby Socket + Redcarpet = Browser-Based Markdown Preview</h2>
    <div class="date">April 29, 2012, 1:48AM</div>
		<div class="content">
			<p>So it’s finals time and I’ve been preparing some single page study sheets with <a href="http://daringfireball.net/projects/markdown/">markdown</a>. I use Markdown for generating PDFs for printing (<a href="https://github.com/jdodds/mkd2pdf">mkd2pdf</a>). In anycase, I had been using my <a href="/projects/markdown-tree">Markdown Tree</a> project in order to faciliate a sort of “live-preview” of the documents I send to mkd2pdf. Nothing against <a href="http://sinatrarb.com">Sinatra</a> but I wanted a lighter solution. Using Markdown-Tree (and Sinatra) purely for its Markdown rendering capability didn’t make sense to me. Really I was just working with Redcarpet and Socket. Sinatra wasn’t doing a damn thing for me.</p>

<p>Thus, I felt Sinatra had no place in the task at hand. What I wanted was a simple commandline tool I could use like <em>markview.rb somefile.md</em> and it would give me a live URL on localhost of the markdown file rendered as HTML.</p>

<p>Luckily Ruby provides an excellent <a href="http://www.ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/Socket.html">Socket Class</a>. Combine that with a markdown renderer such as <a href="http://github.com/tanoku/redcarpet">Redcarpet</a> and you have a simplistic web-based markdown viewing utility. Basically this is just a bit of ruby that interpolates Redcarpet’s rendered results with some HTML. Then, along with a HTTP Header, the HTML is served on port 2000. A CSS file for styling is stored in <em>~/.config/markview</em>.</p>

<p><a href="https://github.com/mil/configs-and-bins/blob/master/bins/markview.rb">markview.rb</a> <em>(/home/mil/bin/markview.rb)</em></p>
<pre class='sh_ruby'>
#!/usr/bin/ruby
require "socket"
require "redcarpet"

def generatePage(filePath)
	#Read style file
	style = File.read("/home/mil/.config/markview/style.css")

	#Use Redcarpet to convert Markdown-&gt;HTML
	redcarpet = Redcarpet::Markdown.new(Redcarpet::Render::HTML)
	markdown = redcarpet.render(File.read(filePath))

	#The Content Header Well Be Serving
	header = "HTTP/1.1 200/OK\r\nContent-type:text/html\r\n\r\n"

	#The Content We'll Be Serving
	content = %(
	&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
	&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
	&lt;head&gt;
		&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
		&lt;title&gt;Markview : #{filePath}&lt;/title&gt;
		&lt;style type="text/css"&gt;#{style}&lt;/style&gt;
	&lt;/head&gt;
	&lt;body&gt;#{markdown}&lt;/body&gt;
	)
	return header, content
end

#Start it Up
server = TCPServer.new('localhost', 2000)
loop do
	header, content = generatePage("#{Dir.getwd}/#{ARGV[0]}")
	Thread.start(server.accept) do |session|
		session.print(header)
		session.print(content)
		session.close
	end
end
</pre>
<p>And that’s it. Instead of using some graphical tool, you can just replace your markdown preview utility with a single-purpose web server. Redcarpet and Socket are all that is needed. Starting this script up is very snappy in comparison with Sinatra scripts.</p>
		</div>
	</div>
</div>

			<footer>
  
    <a title="Back to Blog" class="return" href="/blog">&#171;</a>
  
  <a class='copyright' href="http://creativecommons.org/licenses/by/3.0/" target="_blank" title="CC Attribution 3.0 Unported">&copy;</a>
	<span class="validate">
    <a target="_blank" title='XHTML 1.0 Transitional DTD' href="http://validator.w3.org/check?uri=http://userbound.com//blog/Markview-Ruby-Socket-Plus-Redcarpet">Valid</a><a target="_blank" title='CSS2.1' href="http://jigsaw.w3.org/css-validator/validator?uri=http://userbound.com/style/all.css">ates</a>
  </span>
</footer>

		</div>
	</body>
</html>
